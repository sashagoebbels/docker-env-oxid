version: '3'

services:
  webserver:
    build:
      context: .
      dockerfile: Dockerfile.php7
    ports:
      - "80:80"
    volumes:
      - ./html:/var/www/html
      - php-logs:/var/log/apache2
    links:
      - db

  db:
    build:
      context: .
      dockerfile: Dockerfile.mariadb
    ports:
      - 3306:3306
    environment:
      - MYSQL_ROOT_PASSWORD=rootpw
      - MYSQL_DATABASE=lampserver
      - MYSQL_USER=phpuser
      - MYSQL_PASSWORD=phppw
    volumes:
      - db-logs:/var/log/mysql

  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    ports:
      - 8080:80
    environment:
      MYSQL_USERNAME: root
      MYSQL_ROOT_PASSWORD: rootpw
      PMA_HOST: db
      PMA_ARBITRARY: 1

  elk:
    image: willdurand/elk
    ports:
      - 81:80
    volumes:
      - ./elk/logstash:/etc/logstash
      - ./elk/logstash/patterns:/opt/logstash/patterns
      - php-logs:/var/log/apache2
      - db-logs:/var/log/mysql

volumes:
  php-logs:
  db-logs:
